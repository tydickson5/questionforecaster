<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Question Forecaster</title>
<style>
body { font-family: Arial, sans-serif; background: #f3f3f3; margin: 0; padding: 20px; }
h1 { text-align: center; font-size: 32px; margin-bottom: 20px; }
.course { background: white; padding: 20px; margin: 20px auto; max-width: 700px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.section-title { font-size: 20px; margin-top: 15px; margin-bottom: 8px; }
.item-row { display: flex; justify-content: space-between; background: #f7f7f7; padding: 10px; border-radius: 10px; margin-bottom: 8px; }
button { padding: 6px 14px; border: none; border-radius: 8px; background: #4a6cf7; color: white; cursor: pointer; }
.forecast-sections { margin-top: 10px; }
.forecast-section { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
textarea { width: 100%; border-radius: 10px; padding: 10px; border: 1px solid #ccc; }
</style>
</head>
<body>
<h1>Question Forecaster</h1>
<div id="courses"></div>

<script>
async function getForecast(type, assignment) {
    try {
        const response = await fetch("http://127.0.0.1:5000/forecast", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title: type, assignment: assignment })
        });
        if (!response.ok) throw new Error("Server error: " + response.status);
        const data = await response.json();
        return data.sections;
    } catch (err) {
        console.error("Forecast request failed:", err);
        return ["Error: Unable to fetch forecast."];
    }
}

const coursesDiv = document.getElementById("courses");

// Render all quizzes and assignments dynamically
async function renderAll() {
    const allItems = await getForecast("All", 0); // type="All"
    
    // Group items by course name (optional) or just list
    const courseGroups = {};
    allItems.forEach(item => {
        const courseName = item.course || "Course"; // if your backend includes a course field
        if (!courseGroups[courseName]) courseGroups[courseName] = [];
        courseGroups[courseName].push(item);
    });

    Object.keys(courseGroups).forEach(courseName => {
        const div = document.createElement("div");
        div.className = "course";
        div.innerHTML = `<h2>${courseName}</h2>`;
        
        courseGroups[courseName].forEach(item => {
            const row = document.createElement("div");
            row.className = "item-row";
            row.innerHTML = `<span>${item.title}</span>`;
            
            const btn = document.createElement("button");
            btn.textContent = "Forecast";
            btn.onclick = async () => {
    const type = item.type; 
    const number = item.id || 0;

    const response = await getForecast(type, number);
    const results = response.results; // <-- extract the array

    // Find or create container
    let forecastContainer = row.querySelector(".forecast-sections");
    if (!forecastContainer) {
        forecastContainer = document.createElement("div");
        forecastContainer.className = "forecast-sections";
        row.appendChild(forecastContainer);
    }
    forecastContainer.innerHTML = ""; // clear previous

    // Loop through results and their FAQs
    results.forEach(section => {
        const secDiv = document.createElement("div");
        secDiv.className = "forecast-section";

        const title = document.createElement("h3");
        title.textContent = section.section_title || "Section";
        secDiv.appendChild(title);

        section.faq.forEach(f => {
            const q = document.createElement("p");
            q.innerHTML = `<strong>Q:</strong> ${f.question}`;
            const a = document.createElement("p");
            a.innerHTML = `<strong>A:</strong> ${f.answer}`;
            secDiv.appendChild(q);
            secDiv.appendChild(a);
        });

        forecastContainer.appendChild(secDiv);
    });
};

            
            row.appendChild(btn);
            div.appendChild(row);
        });

        coursesDiv.appendChild(div);
    });
}

// Run on page load
renderAll();
</script>
</body>
</html>
